openapi: 3.1.0
info:
  title: Eloquia API
  version: 0.1.0
servers:
  - url: /
paths:
  /health:
    get:
      summary: Liveness probe
      responses:
        "200":
          description: Service is alive
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StatusResponse"
  /ready:
    get:
      summary: Readiness probe
      responses:
        "200":
          description: Dependencies are ready
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StatusResponse"
        "503":
          description: Dependencies are not ready
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StatusResponse"
  /doctor/register:
    post:
      summary: Register a doctor account
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/DoctorRegisterRequest"
      responses:
        "201":
          description: Doctor created and session started
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DoctorResponse"
        "400":
          description: Invalid request payload
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "409":
          description: Email already exists
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /doctor/login:
    post:
      summary: Authenticate a doctor
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/DoctorLoginRequest"
      responses:
        "200":
          description: Login successful
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DoctorResponse"
        "400":
          description: Invalid request payload
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /doctor/me:
    get:
      summary: Fetch the current doctor
      security:
        - sessionCookie: []
      responses:
        "200":
          description: Current doctor
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DoctorResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /doctor/logout:
    post:
      summary: Terminate the current session
      security:
        - sessionCookie: []
      responses:
        "200":
          description: Logged out
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StatusResponse"
        "401":
          description: No active session
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /practice:
    post:
      summary: Create a practice and assign the current doctor
      security:
        - sessionCookie: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PracticeCreateRequest"
      responses:
        "201":
          description: Practice created and doctor assigned
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PracticeCreateResponse"
        "400":
          description: Invalid request payload
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
components:
  securitySchemes:
    sessionCookie:
      type: apiKey
      in: cookie
      name: eloquia_session
      description: Session cookie issued after login or registration.
  schemas:
    Doctor:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        displayName:
          type: string
        role:
          type: string
          enum: [Owner, Staff]
        practiceId:
          type: string
          format: uuid
          nullable: true
      required: [id, email, displayName, role]
    DoctorRegisterRequest:
      type: object
      properties:
        email:
          type: string
          format: email
        displayName:
          type: string
        password:
          type: string
          format: password
          minLength: 8
      required: [email, displayName, password]
    DoctorLoginRequest:
      type: object
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          format: password
      required: [email, password]
    DoctorResponse:
      type: object
      properties:
        doctor:
          $ref: "#/components/schemas/Doctor"
      required: [doctor]
    Practice:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        address:
          type: string
          nullable: true
        logoUrl:
          type: string
          format: uri
          nullable: true
      required: [id, name]
    PracticeCreateRequest:
      type: object
      properties:
        name:
          type: string
        address:
          type: string
          nullable: true
        logoUrl:
          type: string
          format: uri
          nullable: true
      required: [name]
    PracticeCreateResponse:
      type: object
      properties:
        practice:
          $ref: "#/components/schemas/Practice"
        doctor:
          $ref: "#/components/schemas/Doctor"
      required: [practice, doctor]
    ErrorResponse:
      type: object
      properties:
        error:
          type: string
      required: [error]
    StatusResponse:
      type: object
      properties:
        status:
          type: string
      required: [status]
